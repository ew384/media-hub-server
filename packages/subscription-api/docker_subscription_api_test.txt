[0;35m
🚀 Subscription API 修复版测试
📋 测试目标:
   ✓ 验证与 Auth API 的集成
   ✓ 检查订阅服务基础功能
   ✓ 测试认证Token传递
   ✓ 验证订阅操作完整性
🌐 Auth API: http://localhost:3100/api/v1
🌐 Subscription API: http://localhost:3101
📧 测试邮箱: sub_test_1758257099@example.com
[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m1. 认证服务集成测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 检查Auth服务连接[0m
[0;34m   请求: GET http://localhost:3100/api/v1/health[0m
[0;34m   ℹ️  HTTP状态码: 200[0m
[0;32m   ✅ Auth服务连接正常[0m

[0;36m🧪 测试: 注册测试用户[0m
[0;34m   请求: POST http://localhost:3100/api/v1/auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 用户注册失败[0m


[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m2. 订阅服务连接测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 检查Subscription服务[0m
[0;34m   请求: GET http://localhost:3101[0m
[0;34m   ℹ️  HTTP状态码: 404[0m
[0;32m   ✅ Subscription服务运行中[0m

[0;36m🧪 测试: 健康检查[0m
[0;34m   请求: GET http://localhost:3101/health[0m
[0;34m   ℹ️  HTTP状态码: 404[0m
[0;34m   ℹ️  无健康检查接口或不可访问[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m3. 公开接口测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 获取会员套餐列表[0m
[0;34m   请求: GET http://localhost:3101/subscription/plans[0m
[0;34m   ℹ️  HTTP状态码: 200[0m
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "plans": [
      {
        "id": "monthly",
        "name": "包月套餐",
        "price": 49.9,
        "duration": 1,
        "unit": "month",
        "discount": 0,
        "features": [
          "发布功能",
          "聚合功能",
          "客服支持"
        ],
        "isPopular": false,
        "originalPrice": 49.9
      },
      {
        "id": "quarterly",
        "name": "包季套餐",
        "price": 129,
        "duration": 3,
        "unit": "month",
        "discount": 13.7,
        "features": [
          "发布功能",
          "聚合功能",
          "客服支持",
          "优先支持"
        ],
        "isPopular": true,
        "originalPrice": 129
      },
      {
        "id": "yearly",
        "name": "包年套餐",
        "price": 459,
        "duration": 12,
        "unit": "month",
        "discount": 23.8,
        "features": [
          "发布功能",
          "聚合功能",
          "客服支持",
          "优先支持",
          "VIP群"
        ],
        "isPopular": false,
        "originalPrice": 459
      }
    ]
  }
}
[0;32m   ✅ 套餐列表获取成功 - 包装格式正确[0m
[0;34m   ℹ️  套餐数量: 3[0m
[0;32m   ✅ 套餐数据完整[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m4. 认证集成测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Token，跳过认证集成测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m5. 订阅操作测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Token，跳过订阅操作测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m6. 错误处理测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 无效套餐ID预览[0m
[0;34m   请求: POST http://localhost:3101/subscription/preview[0m
[0;34m   ℹ️  HTTP状态码: 401[0m
{
  "message": "Access token required",
  "error": "Unauthorized",
  "statusCode": 401
}
[0;31m   ❌ 认证失败[0m

[0;36m🧪 测试: 未认证访问保护接口[0m
[0;34m   请求: GET http://localhost:3101/subscription/status[0m
[0;34m   ℹ️  HTTP状态码: 401[0m
[0;32m   ✅ 未认证访问被正确拒绝[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m🏁 测试总结[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;32m✅ 通过测试: 5[0m
[0;31m❌ 失败测试: 4[0m
[0;34m📊 总计测试: 9[0m
[0;36m📈 成功率: 55%[0m

[1;33m🔧 问题诊断:[0m
[0;31m❌ 无法获取认证Token[0m
[0;34m   检查: Auth API 是否在 localhost:3100 运行[0m
[0;34m   检查: 网络连接和端口配置[0m

[0;34m📝 下一步建议:[0m
[1;33m⚠️  需要修复认证集成问题后再对接云服务[0m
