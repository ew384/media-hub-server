[0;35m
🚀 修复后的 Auth API 测试
📋 验证目标:
   ✓ 认证接口返回直接格式（不包装）
   ✓ 其他接口返回包装格式
   ✓ 频率限制正常工作
   ✓ 错误处理格式正确
🌐 测试地址: http://localhost:3100/api/v1
📧 测试邮箱: test_fixed_1758257057@example.com
[0m
[0;32m✅ 服务器连接正常[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m1. 健康检查测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 健康检查接口[0m
[0;34m   请求: GET /health[0m
{
  "code": 200,
  "message": "success",
  "data": {
    "status": "ok",
    "timestamp": "2025-09-19T04:44:17.434Z",
    "uptime": 407.044643993,
    "database": "connected",
    "redis": "connected"
  },
  "timestamp": "2025-09-19T04:44:17.437Z"
}
[0;34m   ℹ️  HTTP状态码: 200[0m
[0;32m   ✅ 健康检查通过 - 包装格式正确[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m2. 短信接口测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 验证无效验证码[0m
[0;34m   请求: POST /sms/verify[0m
{
  "code": 200,
  "message": "success",
  "data": {
    "valid": false
  },
  "timestamp": "2025-09-19T04:44:17.563Z"
}
[0;34m   ℹ️  HTTP状态码: 200[0m
[0;32m   ✅ 验证码验证接口正常 - 包装格式，valid=false[0m

[0;36m🧪 测试: 发送验证码(预期失败)[0m
[0;34m   请求: POST /sms/send[0m
{
  "code": 500,
  "message": "短信发送失败，请稍后重试",
  "data": null,
  "timestamp": "2025-09-19T04:44:17.687Z",
  "path": "/api/v1/sms/send",
  "method": "POST"
}
[0;34m   ℹ️  HTTP状态码: 500[0m
[0;32m   ✅ 短信发送失败符合预期 - 错误格式正确[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m3. 用户注册测试 - 检查响应格式修复[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 邮箱注册[0m
[0;34m   请求: POST /auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 注册失败[0m


[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m4. 用户登录测试 - 检查响应格式修复[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 邮箱登录[0m
[0;34m   请求: POST /auth/login[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 登录失败[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m5. 认证接口测试 - 检查响应格式修复[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Token，跳过认证测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m6. Token操作测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Refresh Token，跳过Token测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m7. 频率限制测试 - 检查是否修复[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;34m   ℹ️  测试注册频率限制（1分钟最多3次）[0m

[0;36m🧪 测试: 频率测试 1/4[0m
[0;34m   请求: POST /auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 第1次注册失败（应该成功）[0m

[0;36m🧪 测试: 频率测试 2/4[0m
[0;34m   请求: POST /auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 第2次注册失败（应该成功）[0m

[0;36m🧪 测试: 频率测试 3/4[0m
[0;34m   请求: POST /auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 第3次注册失败（应该成功）[0m

[0;36m🧪 测试: 频率测试 4/4[0m
[0;34m   请求: POST /auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 第4次注册未被限制（频率限制未生效）[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m8. 错误处理测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 未认证访问[0m
[0;34m   请求: GET /auth/profile[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 未认证访问处理不正确[0m

[0;36m🧪 测试: 参数错误测试[0m
[0;34m   请求: POST /auth/login[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 参数错误处理不正确[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m🏁 测试总结[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;32m✅ 通过测试: 3[0m
[0;31m❌ 失败测试: 10[0m
[0;34m📊 总计测试: 13[0m
[0;36m📈 成功率: 23%[0m

[1;33m🔍 关键修复检查:[0m
[0;31m❌ 认证流程不完整 - 无法获取Token[0m

[0;34m📝 修复验证说明:[0m
[0;34m• 认证接口应返回直接格式（user, accessToken, refreshToken）[0m
[0;34m• 其他接口应返回包装格式（code, message, data, timestamp）[0m
[0;34m• 频率限制应在第4次注册时生效（HTTP 429）[0m
[0;34m• 如果以上都正确，说明修复成功，可以对接阿里云短信[0m

[1;33m⚠️  有 10 个测试失败，请检查修复[0m
