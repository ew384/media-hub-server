[0;35m
🚀 Payment API 完整功能测试
📋 测试目标:
   ✓ 验证支付订单完整流程
   ✓ 测试支付回调接口
   ✓ 验证退款功能
   ✓ 检查管理员功能
   ✓ 确认与认证服务集成
   ✓ 验证错误处理机制
🌐 Payment API: http://localhost:3102
🌐 Auth API: http://localhost:3100/api/v1
📧 测试邮箱: payment_test_1758257115@example.com
[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m3. 认证集成测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 注册测试用户[0m
[0;34m   请求: POST http://localhost:3100/api/v1/auth/register[0m
[0;34m   ℹ️  HTTP状态码: 000[0m
[0;31m   ❌ 用户注册失败[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m4. 支付订单操作测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
DEBUG: ACCESS_TOKEN = ''
DEBUG: Token length = 0
[0;31m   ❌ 没有有效Token，跳过订单操作测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m5. 支付回调接口测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 支付宝回调接口[0m
[0;34m   请求: POST http://localhost:3102/payment/callback/alipay[0m
[0;34m   ℹ️  HTTP状态码: 200[0m
[0;34m   ℹ️  响应: fail[0m
[0;32m   ✅ 支付宝回调接口正常（验证失败是预期的）[0m

[0;36m🧪 测试: 微信支付回调接口[0m
[0;34m   请求: POST http://localhost:3102/payment/callback/wechat[0m
[0;34m   ℹ️  HTTP状态码: 200[0m
[0;34m   ℹ️  响应: <xml><return_code><![CDATA[FAIL]]></return_code><return_msg><![CDATA[ERROR]]></return_msg></xml>[0m
[0;32m   ✅ 微信支付回调接口正常（验证失败是预期的）[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m6. 退款功能测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Token，跳过退款功能测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m7. 管理员接口测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m   ❌ 没有有效Token，跳过管理员接口测试[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m8. 错误处理测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: 未认证访问保护接口[0m
[0;34m   请求: GET http://localhost:3102/payment/orders[0m
[0;32m   ✅ 未认证访问被正确拒绝[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m9. API文档和规范测试[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;36m🧪 测试: Swagger API文档[0m
[0;34m   请求: GET http://localhost:3102/api-docs[0m
[0;32m   ✅ API文档可访问[0m
[0;34m   ℹ️  地址: http://localhost:3102/api-docs[0m

[0;36m🧪 测试: OpenAPI规范检查[0m
[0;34m   请求: GET http://localhost:3102/api-docs-json[0m
[0;32m   ✅ OpenAPI规范格式正确[0m

[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;35m🏁 测试总结与对接准备评估[0m
[0;35m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;32m✅ 通过测试: 5[0m
[0;31m❌ 失败测试: 4[0m
[0;34m📊 总计测试: 9[0m
[0;36m📈 成功率: 55%[0m

[1;33m🔧 真实支付对接准备评估:[0m
[0;31m❌ 基础功能完整性: 不合格[0m
[0;31m❌ 认证集成: 异常[0m
[1;33m⚠️  环境配置: 需要完善[0m
[0;34m   - 配置真实的支付宝/微信支付密钥[0m
[0;34m   - 设置生产环境变量[0m
[0;32m✅ 回调接口: 可用[0m
[0;32m✅ 订单管理: 基础功能完整[0m
[0;32m✅ 错误处理: 机制健全[0m

[0;36m🎯 对接准备度: 66% (4/6)[0m

[1;33m⚠️  Payment API 需要进一步完善后再对接支付服务[0m
[0;31m主要问题: 基础功能或环境配置需要修复[0m
